<aura:component controller="KMZ_MapWorklist_LightningDatatable" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction,forceCommunity:searchInterface" access="global" >
    <aura:attribute name="mapList" type="map[]"/>
    <aura:attribute name="mycolumns" type="List"/>
    <aura:attribute name="sortBy" type="String" default="Name" description="holds the string value of field to sort datatable by"/>
    <aura:attribute name="sortDirection" type="Boolean" default="true" description="used to select sorting order: asc/dec"/>
    <aura:attribute name="placeholder" type="string"/>
    
    <aura:attribute name="isMap" type="Boolean" default="false"/>
    <aura:attribute name="isMap1" type="Boolean" default="false"/>
    
    <aura:attribute name="searchText" type="String" default=""/>
    <aura:attribute name="header" type="String" default=""/>
    <aura:attribute name="activeFilter" type="string" default="all" description="The currently selected actions filter"/>
    <aura:attribute name="rawData" type="Object" description="Stores the currently displayed rows of data"/>
    
    <!--Attibutes added for flag modal-->
    <aura:attribute name="isOpen" type="Boolean" description="for checking if flag modal is open"/>
    <aura:attribute name="modalMessage" type="String" description="for showing what message to display based on whether a quote is flagged or not"/>
    <aura:attribute name="flagAction" type="String" description="for checking if user wants to flag or unflag a quote"/>
    <aura:attribute name="mapId" type="String" description="Stores the quoteId the user clicks on"/>

    <aura:attribute type="map[]" name="allMapList"/>
    <aura:handler name="init" value="{!this}" action="{!c.fetchMap}"/>
    <aura:handler name="init" value="{!this}" action="{!c.populateFilters}"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
     
    <aura:attribute name="selectedCompany" type="String" default="None"/>
    <aura:attribute name="selectedMap" type="String" default="None"/>
    <aura:attribute name="selectedStatus" type="String" default="None"/>
    
    <aura:attribute name="companyOptions" type="List"/>
    <aura:attribute name="mapOptions" type="List"/>
    <aura:attribute name="statusOptions" type="List"/>

    <aura:attribute name="enableInfiniteLoading" type="Boolean" default="true"/>
    <aura:attribute name="initialRows" type="Integer" default="8"/>
    <aura:attribute name="currentCount" type="Integer" default="8"/>
    <aura:attribute name="totalRows" type="Integer" default="0"/>
    <!--Set loadOffset to trigger when to load more rows-->
    <!--set default to how many pixels the table's scroll position is from the bottom of table -->
    <aura:attribute name="loadOffset" type="Integer" default="1"/>
    
    <!-- Dynamic URL code start -->
    <aura:attribute name= "DomainUrl" type="String"/>
    <c:VPS_DynamicURL DomainUrl="{!v.DomainUrl}"/>
    <!-- Dyanmic URL code end -->
    
    <!-- changes are made by moina to add the advanced search -->   
    <aura:attribute name="filter" type="String" default=""/>
  	<aura:handler event="c:SearchKeyChange" action="{!c.fetchMap}"/>
    <!--<aura:handler event="aura:waiting" action="{!c.showSpinner}"/>
    <aura:handler event="aura:doneWaiting" action="{!c.hideSpinner}"/>--><!--Commented deprecated events-->
    <aura:attribute name="Spinner" type="boolean" default="false"/>
    <aura:attribute name="MapNameIcon" type="String" default="utility:sort"/>
    <aura:attribute name="SearchFlg" type="Boolean" default="false"/>

    <aura:attribute name="srvLocFilterLst" type="List"/>
    <aura:attribute name="groupFilterLst" type="List"/>

    <aura:if isTrue="{!v.Spinner}">
        <div aura:id="spinnerId" class="slds-spinner_container">
        <div class="slds-spinner--brand slds-spinner slds-spinner--large slds-is-relative" role="alert">
        <span class="slds-assistive-text">Loading</span>
        <div class="slds-spinner__dot-a"></div>
        <div class="slds-spinner__dot-b"></div>
	</div>
	</div>
	</aura:if>
    <div>
        <aura:if isTrue="{!v.isMap}">
            <h1 class="mapWorklistHeader slds-m-bottom_large">Map Worklist</h1>
  		</aura:if>
        <aura:if isTrue="{!v.isMap1}">
            <h1 class="mapWorklistHeaderDynamic slds-m-bottom_large">Map Worklist</h1>
  		</aura:if>
        </div>
    <div class="slds-form-element slds-lookup" data-select="single">
        <div  class="formElementMargin slds-form-element__control">
            <div class="slds-input-has-icon slds-input-has-icon--right">
                      <lightning:buttonIcon iconName="utility:search" variant="bare" onclick="{! c.updateFilter }" alternativeText="Search" class="slds-input__icon searchiconClass" aura:id="searchButton" />
                
            <div class="slds-m-around--x-small">
                     <!--lightning:Icon iconName="action:close"  class="slds-input__icon closeClass"  onclick="{! c.updateFilter }"/-->
                       <lightning:button  iconName="utility:close" class="slds-input__icon closeClass"  onclick="{! c.clearfilter }" />
               </div>
                
                 
                <ui:inputText value="{!v.filter}"  class="slds-lookup__search-input slds-input" placeholder="Search Worklist" keyup="{!c.updateFilter}" />
            </div> 
        </div>
    </div>
    <!-- end of Advanced search --> 
    <p id="advancefilter"  style="
    display: inline;
    float: left;
    padding-left: 5px;
    font-size: 12pt;
    padding-top: 29px;">Filter by:</p>
    
	 <div class="tableFilteringOptions" style="font-family: NeueHaasGroteskDisplayBold; height: 35px; margin-top: 30px; margin-bottom: 10px; font-size: 14px;">
    
	<lightning:combobox name="Map Filter" class="slds-float_left slds-m-right_small MapComboBox" options="{!v.mapOptions}" variant="label-hidden" onchange="{!c.updateMap}" placeholder="All Map Types" aura:id="mapFilter" style="width: 230px;"/>
	<lightning:combobox name="Status Filter" class="slds-float_left slds-m-right_small MapComboBox" options="{!v.statusOptions}" variant="label-hidden" onchange="{!c.updateStatus}" placeholder="Status" aura:id="statusFilter" style="width: 230px;"/>	
    <lightning:combobox name="Company Filter" class="slds-float_left slds-m-right_small MapComboBox" options="{!v.companyOptions}" variant="label-hidden" onchange="{!c.updateCompany}" placeholder="All Companies" aura:id="companyFilter" style="padding-left: 10px; width: 300px;" />
    <span style ="border-radius:0px;"><lightning:button name="Apply Filter" class="slds-float_left applybutton" variant="destructive" onclick="{!c.updateMaps}">Apply</lightning:button> </span>      
    
    <span style ="border-radius:0px;"><lightning:button variant="neutral" class="buttonStyling slds-float_right slds-m-right_small slds-text-color_default downloadBtn" label="Download Worklist" onclick="{! c.downloadWorklist}"/></span>
    
    <br></br>
    <br></br>
    </div>
    <div class="container tableHeight" style="height: 36.3774rem ;margin-top: 20px ;border: 1px solid lightgrey !important;
    box-shadow: 1px 2px 3px grey !important;margin-bottom: 0.9375rem !important;">
        <lightning:datatable columns="{! v.mycolumns }" 
                             data="{! v.mapList }" 
                             keyField="Id"
                             aura:id="mapTable"
                             hideCheckboxColumn="true"
                             sortable="true"
                             onsort="{!c.sortTable}"
                             sortedBy="{!v.sortBy}"
                             sortedDirection="{!v.sortDirection}"
                             class="datatable"
                             onrowaction="{!c.handleRowAction }"
                             onheaderaction="{! c.handleHeaderAction }"
                             enableInfiniteLoading="{!v.enableInfiniteLoading}"
                             loadMoreOffset="{!v.loadOffset}"
                             
                             />
                             
        <!-- <img src="/resource/Flag" alt="Flag" border="0"/>-->
    </div>

    <!-- For flag modal -->
    <aura:if isTrue="{!v.isOpen}">
        <section class="slds-modal slds-fade-in-open" role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
            <div class="slds-modal__container">
                <header class="slds-modal__header slds-modal__header_empty">
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-align_absolute-center slds-m-top_large">{!v.modalMessage}</h2>
                </header>
                <lightning:buttonIcon iconName="utility:close"
                                      onclick="{! c.closeModal }"
                                      alternativeText="close"
                                      variant="bare-inverse"
                                      class="slds-modal__close"/>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <div class="slds-align_absolute-center">
                        <lightning:button class="noButton" label="No" onclick="{! c.closeModal }"/>
                        <lightning:button class="yesButton" label="Yes" onclick="{! c.editFlag }"/>
                    </div>
                </div>
            </div>

        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
</aura:component>
